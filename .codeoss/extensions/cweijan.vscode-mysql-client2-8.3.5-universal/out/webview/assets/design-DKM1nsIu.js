import{Fragment as e,computed as t,createBaseVNode as n,createBlock as r,createCommentVNode as i,createElementBlock as a,createTextVNode as o,createVNode as s,defineComponent as c,h as l,handler as u,hyphenate as d,isObject as f,isRef as p,isString as m,nextTick as h,normalizeClass as g,normalizeStyle as _,onMounted as v,openBlock as y,reactive as b,ref as x,renderList as S,resolveComponent as C,toDisplayString as w,toRefs as T,unref as E,withCtx as D,withDirectives as O}from"./vscode-ByQLBi_r.js";import{ElForm as ee,ElFormItem as te,Transition as k,addClass as A,createApp as j,getStyle as M,isClient as N,removeClass as P,vShow as F,withKeys as I,withModifiers as L}from"./focus-trap-CSSWZImT.js";import{defineStore as R,storeToRefs as z}from"./pinia-BVG5H93L.js";import{$t as B,ElInput as V,confirmEl as H,error as U,success as ne,useGlobalComponentSettings as re}from"./notify-DqF5XRqJ.js";import{__plugin_vue_export_helper_default as W}from"./_plugin-vue_export-helper-C32SG5g-.js";import"./tooltip-CVpAU6Sv.js";import"./isEqual-CdOvZtUE.js";import{ElOption as ie,ElSelect as ae}from"./select-GJDkBNl3.js";import"./_baseFindIndex-Be7HZc5f.js";import"./isArrayLikeObject-05TlFTR_.js";import"./merge-DTOcvLG1.js";import"./_baseIteratee-CSRzNRlS.js";import{ElTable as oe,ElTableColumn as se}from"./table-RpKCEj1I.js";import"./isUndefined-Cqoojwy1.js";import{ElDialog as ce}from"./dialog-BEu6-a3T.js";import"./use-empty-values-DiN_VYta.js";import"./click-outside-auYYsqs3.js";import{ElCheckbox as le}from"./checkbox-BaDld0em.js";import"./tag-CWpNjs-a.js";import{ElPopover as ue}from"./popover-DP0GWF0c.js";import{DatabaseType as G,isPGFamily as K}from"./constants-AMjnVokj.js";import{EscapedOption as de,getDefault as q,isEmpty$1 as J,isTrue as fe,wrapByDb as Y}from"./wrapper-CouIgP_9.js";import{listenHeight as pe}from"./common_view_utils-BBmLTt25.js";import"./objectUtil-BEldwiwk.js";import{ArrayUtil as me}from"./arrayUtil-_jFWE7hg.js";import{getDialect as he}from"./getDialect-DLsTpfdG.js";import{StringBuilder as X}from"./stringBuilder-yJYixDZK.js";import{codemirror_default as ge}from"./codemirror-QBTlYVWA.js";function _e(e){let t,n=x(!1),r=b({...e,originalPosition:``,originalOverflow:``,visible:!1});function i(e){r.text=e}function a(){let e=r.parent,t=m.ns;if(!e.vLoadingAddClassList){let n=e.getAttribute(`loading-number`);n=Number.parseInt(n)-1,n?e.setAttribute(`loading-number`,n.toString()):(P(e,t.bm(`parent`,`relative`)),e.removeAttribute(`loading-number`)),P(e,t.bm(`parent`,`hidden`))}o(),p.unmount()}function o(){var e,t;(t=(e=m.$el)?.parentNode)==null||t.removeChild(m.$el)}function u(){var i;e.beforeClose&&!e.beforeClose()||(n.value=!0,clearTimeout(t),t=window.setTimeout(d,400),r.visible=!1,(i=e.closed)==null||i.call(e))}function d(){if(!n.value)return;let e=r.parent;n.value=!1,e.vLoadingAddClassList=void 0,a()}let f=c({name:`ElLoading`,setup(e,{expose:t}){let{ns:n,zIndex:i}=re(`loading`);return t({ns:n,zIndex:i}),()=>{let e=r.spinner||r.svg,t=l(`svg`,{class:`circular`,viewBox:r.svgViewBox?r.svgViewBox:`0 0 50 50`,...e?{innerHTML:e}:{}},[l(`circle`,{class:`path`,cx:`25`,cy:`25`,r:`20`,fill:`none`})]),i=r.text?l(`p`,{class:n.b(`text`)},[r.text]):void 0;return l(k,{name:n.b(`fade`),onAfterLeave:d},{default:D(()=>[O(s(`div`,{style:{backgroundColor:r.background||``},class:[n.b(`mask`),r.customClass,r.fullscreen?`is-fullscreen`:``]},[l(`div`,{class:n.b(`spinner`)},[t,i])]),[[F,r.visible]])])})}}}),p=j(f),m=p.mount(document.createElement(`div`));return{...T(r),setText:i,removeElLoadingChild:o,close:u,handleAfterLeave:d,vm:m,get $el(){return m.$el}}}let Z;const ve=function(e={}){if(!N)return;let t=ye(e);if(t.fullscreen&&Z)return Z;let n=_e({...t,closed:()=>{var e;(e=t.closed)==null||e.call(t),t.fullscreen&&(Z=void 0)}});be(t,t.parent,n),xe(t,t.parent,n),t.parent.vLoadingAddClassList=()=>xe(t,t.parent,n);let r=t.parent.getAttribute(`loading-number`);return r=r?`${Number.parseInt(r)+1}`:`1`,t.parent.setAttribute(`loading-number`,r),t.parent.appendChild(n.$el),h(()=>n.visible.value=t.visible),t.fullscreen&&(Z=n),n},ye=e=>{var t,n,r,i;let a;return a=m(e.target)?(t=document.querySelector(e.target))??document.body:e.target||document.body,{parent:a===document.body||e.body?document.body:a,background:e.background||``,svg:e.svg||``,svgViewBox:e.svgViewBox||``,spinner:e.spinner||!1,text:e.text||``,fullscreen:a===document.body&&((n=e.fullscreen)??!0),lock:(r=e.lock)??!1,customClass:e.customClass||``,visible:(i=e.visible)??!0,target:a}},be=async(e,t,n)=>{let{nextZIndex:r}=n.vm.zIndex||n.vm._.exposed.zIndex,i={};if(e.fullscreen)n.originalPosition.value=M(document.body,`position`),n.originalOverflow.value=M(document.body,`overflow`),i.zIndex=r();else if(e.parent===document.body){n.originalPosition.value=M(document.body,`position`),await h();for(let t of[`top`,`left`]){let n=t===`top`?`scrollTop`:`scrollLeft`;i[t]=`${e.target.getBoundingClientRect()[t]+document.body[n]+document.documentElement[n]-Number.parseInt(M(document.body,`margin-${t}`),10)}px`}for(let t of[`height`,`width`])i[t]=`${e.target.getBoundingClientRect()[t]}px`}else n.originalPosition.value=M(t,`position`);for(let[e,t]of Object.entries(i))n.$el.style[e]=t},xe=(e,t,n)=>{let r=n.vm.ns||n.vm._.exposed.ns;[`absolute`,`fixed`,`sticky`].includes(n.originalPosition.value)?P(t,r.bm(`parent`,`relative`)):A(t,r.bm(`parent`,`relative`)),e.fullscreen&&e.lock?A(t,r.bm(`parent`,`hidden`)):P(t,r.bm(`parent`,`hidden`))},Se=Symbol(`ElLoading`),Ce=(e,t)=>{var n,r,i,a;let o=t.instance,s=e=>f(t.value)?t.value[e]:void 0,c=e=>{let t=m(e)&&o?.[e]||e;return t&&x(t)},l=t=>c(s(t)||e.getAttribute(`element-loading-${d(t)}`)),u=(n=s(`fullscreen`))??t.modifiers.fullscreen,p={text:l(`text`),svg:l(`svg`),svgViewBox:l(`svgViewBox`),spinner:l(`spinner`),background:l(`background`),customClass:l(`customClass`),fullscreen:u,target:(r=s(`target`))??(u?void 0:e),body:(i=s(`body`))??t.modifiers.body,lock:(a=s(`lock`))??t.modifiers.lock};e[Se]={options:p,instance:ve(p)}},we=(e,t)=>{for(let n of Object.keys(t))p(t[n])&&(t[n].value=e[n])},Te={mounted(e,t){t.value&&Ce(e,t)},updated(e,t){let n=e[Se];t.oldValue!==t.value&&(t.value&&!t.oldValue?Ce(e,t):t.value&&t.oldValue?f(t.value)&&we(t.value,n.options):n?.instance.close())},unmounted(e){var t;(t=e[Se])==null||t.instance.close(),e[Se]=null}},Q=R(`design`,{state:()=>({schema:``,table:``,columns:[],tableMeta:{},dbType:G.MYSQL,dialect:null,remainHeight:0,activePanel:`column`}),getters:{canAlterTable(e){try{var t;return(t=e.dialect)?.updateColumn({oldRow:{}})!=null}catch(e){return console.error(`canAlterTable`,e),!0}},supportForeignKey(e){var t;return(t=e.dialect)?.showForeignKeys()},supportCheck(e){var t;return(t=e.dialect)?.showChecks()},supportTrigger(e){var t;return(t=e.dialect)?.showTriggers()},supportIndex(e){var t;return(t=e.dialect)?.showIndex()&&![G.SNOWFLAKE,G.DATABRICKS,G.ATHENA,G.BIG_QUERY,G.PRESTO,G.TRINO].includes(e.dbType)}},actions:{updateDBType(e){this.dbType=e},updateFullInfo(e){for(let t in e)this[t]=e[t]}}}),Ee={class:`design-toolbar`},De={class:`text-center`};var Oe=c({__name:`IndexPanel`,setup(c){let l=x([]),d=x([]),f=x(!0),p=Q(),{dbType:m,dialect:h,remainHeight:g,activePanel:_}=z(p),T={visible:!1,loading:!1,column:null,columns:null,type:`INDEX`},k=b({...T}),A=t(()=>{var e;return(e=k.columns)?.length>0?h.value.newIndex({...k}):``});v(()=>{u.on(`designMetaNext`,()=>{k.visible=!1,d.value=h.value.indexTypes(),j()}).on(`indexes`,e=>{l.value=e,f.value=!1}).on(`success`,e=>{e==`index`&&(k.loading=!1,k.visible=!1,j())}).on(`error`,()=>{k.loading=!1})});let j=()=>{u.emit(`indexes`),f.value=!0},M=()=>{Object.assign(k,T),k.visible=!0,k.loading=!1},N=e=>h.value.formatIndexType(e),P=()=>{k.loading=!0,u.emit(`execute`,{type:`index`,sql:A.value})},I=e=>{H(B(`design.deleteIndexConfirm`)).then(()=>{u.emit(`execute`,{type:`index`,sql:h.value.dropIndex(e.index_name)})})};return(t,c)=>{let u=C(`vsc-button`),h=C(`vsc-tooltip`),v=se,b=le,x=oe,T=C(`RedMark`),L=ie,R=ae,z=te,V=ee,H=ce,U=Te;return y(),a(`div`,null,[n(`div`,Ee,[s(h,{title:E(B)(`common.new`)},{default:D(()=>[[`ClickHouse`].includes(E(m))?i(``,!0):(y(),r(u,{key:0,type:`icon`,icon:`codicon-add text-base`,onClick:M}))]),_:1},8,[`title`]),s(h,{title:E(B)(`common.refresh`)},{default:D(()=>[s(u,{type:`icon`,icon:`codicon-refresh text-base`,onClick:j})]),_:1},8,[`title`])]),E(_)==`index`?O((y(),r(x,{key:0,data:l.value,height:E(g),border:``},{default:D(()=>[s(v,{resizable:!0,align:`center`,prop:`index_name`,label:E(B)(`design.indexName`),width:`200`},null,8,[`label`]),s(v,{resizable:!0,align:`center`,prop:`column_name`,label:E(B)(`design.column`),width:`200`},null,8,[`label`]),s(v,{align:`center`,prop:`isUnique`,label:E(B)(`design.unique`),width:`200`},{default:D(({row:e})=>[s(b,{disabled:``,"model-value":E(fe)(e.isUnique)},null,8,[`model-value`])]),_:1},8,[`label`]),s(v,{resizable:!0,align:`center`,prop:`index_type`,label:E(B)(`common.type`),width:`200`},{default:D(({row:e})=>[o(w(N(e)),1)]),_:1},8,[`label`]),E(K)(E(m))?(y(),r(v,{key:0,resizable:!0,align:`center`,prop:`index_method`,label:E(B)(`design.indexMethod`),width:`200`},null,8,[`label`])):i(``,!0),[`ClickHouse`].includes(E(m))?i(``,!0):(y(),r(v,{key:1,label:E(B)(`design.operation`),width:`120`},{default:D(({row:e})=>[n(`div`,De,[s(u,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>I(e)},null,8,[`onClick`])])]),_:1},8,[`label`]))]),_:1},8,[`data`,`height`])),[[U,f.value]]):i(``,!0),s(H,{modelValue:k.visible,"onUpdate:modelValue":c[3]||=e=>k.visible=e,"show-close":!1,title:E(B)(`design.newIndex`),width:`520px`,closeOnClickModal:!1,center:``},{footer:D(()=>[s(u,{type:`secondary`,onClick:c[2]||=e=>k.visible=!1},{default:D(()=>[o(w(E(B)(`common.cancel`)),1)]),_:1}),s(u,{type:`primary`,loading:k.loading,onClick:P},{default:D(()=>[o(w(E(B)(`common.ok`)),1)]),_:1},8,[`loading`]),c[4]||=n(`br`,null,null,-1),c[5]||=o(),c[6]||=n(`br`,null,null,-1),O(s(ge,{ref:`cmEditor`,value:A.value,readonly:!0},null,8,[`value`]),[[F,A.value]])]),default:D(()=>[s(V,{inline:!0,"label-width":`75px`,size:`small`},{default:D(()=>[s(z,null,{label:D(()=>[s(T),o(w(E(B)(`design.column`)),1)]),default:D(()=>[s(R,{modelValue:k.columns,"onUpdate:modelValue":c[0]||=e=>k.columns=e,size:`small`,filterable:``,multiple:``,class:`!w-[150px]`},{default:D(()=>[(y(!0),a(e,null,S(E(p).columns,e=>(y(),r(L,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),s(z,null,{label:D(()=>[s(T),o(w(E(B)(`common.type`)),1)]),default:D(()=>[s(R,{modelValue:k.type,"onUpdate:modelValue":c[1]||=e=>k.type=e,size:`small`,class:`!w-[110px]`},{default:D(()=>[(y(!0),a(e,null,S(d.value,(e,t)=>(y(),r(L,{key:t,label:e.label,value:e.value},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),ke=Oe;const Ae={ref:`infoPanel`,class:`design-toolbar`};var je=c({__name:`DDL`,setup(e){let t=Q(),o=x(!1),c=x(``);v(()=>{u.on(`designMetaNext`,()=>{u.emit(`ddl`)}).on(`ddl`,({ddl:e})=>{o.value=!1,c.value=e})});let l=()=>{navigator.clipboard.writeText(c.value),ne(`Copy DDL success!`)};return(e,d)=>{let f=C(`vsc-button`),p=C(`vsc-tooltip`),m=Te;return O((y(),a(`div`,null,[n(`div`,Ae,[s(p,{title:`Copy DDL`},{default:D(()=>[s(f,{type:`icon`,icon:`el-icon-document-copy text-base`,onClick:l})]),_:1}),s(p,{title:e.$t(`common.refresh`)},{default:D(()=>[s(f,{type:`icon`,icon:`codicon-refresh text-base`,onClick:d[0]||=e=>E(u).emit(`ddl`)})]),_:1},8,[`title`])],512),E(t).activePanel==`ddl`?(y(),r(ge,{key:0,dbType:E(t).dbType,value:c.value,readonly:!0,style:_({maxHeight:E(t).remainHeight+`px`,overflow:`auto`}),class:`large`},null,8,[`dbType`,`value`,`style`])):i(``,!0)])),[[m,o.value]])}}}),Me=je;const Ne={key:0,class:`design-toolbar`},Pe={class:`text-center`};var Fe=c({__name:`ForeignKey`,setup(c){let l=Q(),{dialect:d,canAlterTable:f,remainHeight:p,activePanel:m}=z(l),h=x([]),g=x([]),_=x([]),T=x([]),k=x(!0),A=b({visible:!1,loading:!1}),j={column:null,refTable:null,refColumn:null,foreignKeyName:null,onUpdate:`NO ACTION`,onDelete:`NO ACTION`},M=b({...j}),N=t(()=>{let{column:e,refTable:t,refColumn:n}=M;return e||t||n?d.value.newForeignKey(M):``});v(()=>{u.on(`designMetaNext`,()=>{A.visible=!1,T.value=d.value.strategies(),I(),u.emit(`tables`)}).on(`foreignKeys`,e=>{k.value=!1,h.value=e}).on(`columnsById`,e=>{M.refColumn=``,_.value=e}).on(`success`,e=>{e==`fk`&&(A.loading=!1,A.visible=!1,I())}).on(`error`,()=>{A.loading=!1}).on(`tables`,e=>{g.value=e})});let P=e=>{u.emit(`columnsById`,e)},I=()=>{let e=d.value.showForeignKeys();e&&(k.value=!0,u.emit(`foreignKeys`,e))},L=()=>{Object.assign(M,j),A.visible=!0,A.loading=!1},R=()=>{A.loading=!0,u.emit(`execute`,{type:`fk`,sql:N.value})},U=e=>{H(B(`design.deleteFkConfirm`)).then(()=>{u.emit(`execute`,{type:`fk`,sql:d.value.dropForeignKey(e.constraint_name)})})};return(t,c)=>{let u=C(`vsc-button`),d=C(`vsc-tooltip`),v=se,b=oe,x=C(`RedMark`),j=ie,z=ae,H=te,ne=V,re=ee,W=ce,le=Te;return y(),a(`div`,null,[E(f)?(y(),a(`div`,Ne,[s(d,{title:E(B)(`common.new`)},{default:D(()=>[s(u,{type:`icon`,icon:`codicon-add text-base`,onClick:L})]),_:1},8,[`title`]),s(d,{title:E(B)(`common.refresh`)},{default:D(()=>[s(u,{type:`icon`,icon:`codicon-refresh text-base`,onClick:I})]),_:1},8,[`title`])])):i(``,!0),E(m)==`foreignKey`?O((y(),r(b,{key:1,data:h.value,style:{width:`100%`},height:E(p),border:``},{default:D(()=>[E(f)?(y(),r(v,{key:0,resizable:!0,align:`center`,prop:`constraint_name`,label:E(B)(`design.constraintName`),width:`150`},null,8,[`label`])):i(``,!0),s(v,{resizable:!0,align:`center`,prop:`column_name`,label:E(B)(`design.column`),width:`150`},null,8,[`label`]),s(v,{resizable:!0,align:`center`,prop:`referenced_table`,label:E(B)(`design.referencedTable`),width:`150`},null,8,[`label`]),s(v,{resizable:!0,align:`center`,prop:`referenced_column`,label:E(B)(`design.referencedColumn`),width:`155`},null,8,[`label`]),s(v,{align:`center`,prop:`updateRule`,label:E(B)(`design.updateRule`),width:`150`},null,8,[`label`]),s(v,{align:`center`,prop:`deleteRule`,label:E(B)(`design.deleteRule`),width:`150`},null,8,[`label`]),E(f)?(y(),r(v,{key:1,label:E(B)(`design.operation`),width:`120`},{default:D(({row:e})=>[n(`div`,Pe,[s(u,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>U(e)},null,8,[`onClick`])])]),_:1},8,[`label`])):i(``,!0)]),_:1},8,[`data`,`height`])),[[le,k.value]]):i(``,!0),s(W,{modelValue:A.visible,"onUpdate:modelValue":c[7]||=e=>A.visible=e,"show-close":!1,title:E(B)(`design.newForeignKey`),width:`780px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:D(()=>[s(u,{type:`secondary`,onClick:c[6]||=e=>A.visible=!1},{default:D(()=>[o(w(E(B)(`common.cancel`)),1)]),_:1}),s(u,{type:`primary`,loading:A.loading,onClick:R},{default:D(()=>[o(w(E(B)(`common.ok`)),1)]),_:1},8,[`loading`]),c[9]||=n(`br`,null,null,-1),c[10]||=o(),c[11]||=n(`br`,null,null,-1),O(s(ge,{ref:`cmEditor`,value:N.value,readonly:!0},null,8,[`value`]),[[F,N.value]])]),default:D(()=>[s(re,{inline:!0,"label-width":`150px`,"label-position":`left`,size:`small`},{default:D(()=>[s(H,null,{label:D(()=>[s(x),o(w(E(B)(`design.column`)),1)]),default:D(()=>[s(z,{modelValue:M.column,"onUpdate:modelValue":c[0]||=e=>M.column=e,size:`small`,filterable:``,class:`!w-[170px] mr-4`},{default:D(()=>[(y(!0),a(e,null,S(E(l).columns,e=>(y(),r(j,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),s(H,null,{label:D(()=>[o(w(E(B)(`design.constraintName`)),1)]),default:D(()=>[s(ne,{modelValue:M.foreignKeyName,"onUpdate:modelValue":c[1]||=e=>M.foreignKeyName=e,class:`!w-[170px]`},null,8,[`modelValue`])]),_:1}),c[8]||=n(`br`,null,null,-1),s(H,null,{label:D(()=>[s(x),o(w(E(B)(`design.referencedTable`)),1)]),default:D(()=>[s(z,{modelValue:M.refTable,"onUpdate:modelValue":c[2]||=e=>M.refTable=e,size:`small`,filterable:``,class:`!w-[170px] mr-4`},{default:D(()=>[(y(!0),a(e,null,S(g.value,e=>(y(),r(j,{key:e.name,label:e.name,value:e.name,onClick:t=>P(e.id)},null,8,[`label`,`value`,`onClick`]))),128))]),_:1},8,[`modelValue`])]),_:1}),s(H,null,{label:D(()=>[s(x),o(w(E(B)(`design.referencedColumn`)),1)]),default:D(()=>[s(z,{modelValue:M.refColumn,"onUpdate:modelValue":c[3]||=e=>M.refColumn=e,size:`small`,filterable:``,class:`!w-[170px]`},{default:D(()=>[(y(!0),a(e,null,S(_.value,e=>(y(),r(j,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),s(H,{label:`On Update`},{default:D(()=>[s(z,{modelValue:M.onUpdate,"onUpdate:modelValue":c[4]||=e=>M.onUpdate=e,size:`small`,filterable:``,class:`!w-[170px] mr-4`},{default:D(()=>[(y(!0),a(e,null,S(T.value,e=>(y(),r(j,{key:e,label:e,value:e},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),s(H,{label:`On Delete`},{default:D(()=>[s(z,{modelValue:M.onDelete,"onUpdate:modelValue":c[5]||=e=>M.onDelete=e,size:`small`,filterable:``,class:`!w-[170px]`},{default:D(()=>[(y(!0),a(e,null,S(T.value,e=>(y(),r(j,{key:e,label:e,value:e},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),Ie=Fe;const Le={key:0,ref:`infoPanel`,class:`design-toolbar`},Re=[`title`],ze={class:`text-center`},Be={class:`max-h-[300px] overflow-y-auto`},Ve=[`onClick`];var He=c({__name:`ColumnPanel`,setup(c){let l=Q(),{dbType:d,columns:f,dialect:p,canAlterTable:m,remainHeight:h,activePanel:g}=z(l),_=b({visible:!1,inputting:!1}),T=t(()=>p.value.columnTypes()),k=x([]),A=x(!1),j=x(!0),M=x([]),N={name:``,type:``,unsigned:null,zerofill:null,comment:null,isNotNull:null,defaultValue:null,useCurrentTimestamp:null},P=b({...N}),L=b({isNew:!0,editDisable:!1,editVisible:!1,editLoading:!1}),R=t(()=>{var e,t;return W.value&&((e=P.type)==null||(t=e.match)==null?void 0:t.call(e,/(\bint|decimal|float|double)/i))}),ne=t(()=>{var e,t;return W.value&&((e=P.type)==null||(t=e.match)==null?void 0:t.call(e,/timestamp/i))}),re=t(()=>window.innerWidth<=1200),W=t(()=>[`MySQL`,`Doris`,`MariaDB`].includes(d.value)),ie=t(()=>{let e=L.isNew?`design.newColumn`:`design.updateColumn`;return B(e)}),ae=t(()=>_.inputting&&P.type?T.value.filter(e=>(e.label||e).match(new RegExp(P.type,`i`))):T.value),K=t(()=>{if(L.isNew){let{name:e,type:t}=P;return e&&t?p.value.newColumn(P):``}R.value||(P.zerofill=!1,P.unsigned=!1),ne.value||(P.useCurrentTimestamp=!1);try{return p.value.updateColumn({newColumnName:P.name,columnType:P.type,nullable:!P.isNotNull,...P})}catch(e){return console.error(e),L.editDisable=!0,e}}),de=t(()=>[G.MYSQL,G.MARIA_DB,G.PG,G.DB2].includes(d.value));v(()=>{u.on(`designMetaNext`,e=>{M.value=me.clone(e.columns),L.editVisible=!1,j.value=!1}).on(`columns`,e=>{M.value=me.clone(e),j.value=!1}).on(`indexes`,e=>{A.value=!0,k.value=e.filter(e=>fe(e.isUnique)).map(e=>e.column_name)}).on(`success`,e=>{e==`column`&&(L.editLoading=!1,L.editVisible=!1,pe())}).on(`error`,()=>{L.editLoading=!1,pe()})});let q=(...e)=>!e.includes(d.value),J=e=>{e&&(P.defaultValue=`CURRENT_TIMESTAMP`)},Y=()=>{let e=ae.value[0];e&&(P.type=e.value||e,_.visible=!1)},pe=()=>{u.emit(`columns`),j.value=!0},he=()=>{Object.assign(P,N),L.isNew=!0,L.editVisible=!0},X=e=>{Object.assign(P,{...e,columnName:e.name,oldRow:e}),L.isNew=!1,L.editVisible=!0,L.editDisable=!1,L.editLoading=!1},_e=(e,t)=>{L.isNew=!1,Object.assign(P,{...e,columnName:e.name,oldRow:M.value[t]}),Z()},Z=()=>{if(!K.value)return U(`No any change!`);if(L.editLoading=!0,L.isNew)return ve();try{u.emit(`execute`,{type:`column`,sql:K.value})}catch(e){U(e.message),L.editLoading=!1}},ve=()=>{u.emit(`execute`,{type:`column`,sql:K.value})},ye=e=>{H(B(`design.deleteColumnConfirm`)).then(()=>{u.emit(`execute`,{type:`column`,sql:p.value.dropColumn(e.name)})})};return(t,c)=>{let l=C(`vsc-button`),u=C(`vsc-tooltip`),p=se,v=le,b=oe,x=C(`RedMark`),T=V,M=te,N=ue,z=ee,H=ce,U=Te;return y(),a(`div`,null,[E(m)?(y(),a(`div`,Le,[s(u,{title:E(B)(`common.new`)},{default:D(()=>[s(l,{type:`icon`,icon:`codicon-add text-base`,onClick:he})]),_:1},8,[`title`]),s(u,{title:E(B)(`common.refresh`)},{default:D(()=>[s(l,{type:`icon`,icon:`codicon-refresh text-base`,onClick:pe})]),_:1},8,[`title`])],512)):i(``,!0),E(g)==`column`?O((y(),r(b,{key:1,data:E(f),height:E(h),border:``,onRowDblclick:X},{default:D(()=>[s(p,{resizable:!0,align:`center`,prop:`name`,label:E(B)(`common.name`),width:`180`},null,8,[`label`]),s(p,{resizable:!0,align:`center`,prop:`type`,label:E(B)(`common.type`),width:re.value?100:130},null,8,[`label`,`width`]),s(p,{resizable:!0,align:`center`,prop:`maximum_length`,width:80,label:E(B)(`design.length`)},null,8,[`label`]),[`DuckDB`].includes(E(d))?i(``,!0):(y(),r(p,{key:0,resizable:!0,align:`center`,prop:`comment`,label:E(B)(`common.comment`),width:`100`},{default:D(({row:e})=>[n(`span`,{title:e?.comment},w(e?.comment),9,Re)]),_:1},8,[`label`])),s(p,{resizable:!0,align:`center`,prop:`defaultValue`,width:re.value?75:110,label:E(B)(`common.default`)},null,8,[`width`,`label`]),s(p,{align:`center`,label:`Not Null`,width:80},{default:D(({row:e,$index:t})=>[s(v,{modelValue:e.isNotNull,"onUpdate:modelValue":t=>e.isNotNull=t,onChange:n=>_e(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`onChange`])]),_:1}),s(p,{align:`center`,label:E(B)(`design.isPrimary`),width:110},{default:D(({row:e})=>[s(v,{disabled:``,"model-value":e.isPrimary},null,8,[`model-value`])]),_:1},8,[`label`]),A.value||[`MySQL`,`MariaDB`,`Doris`].includes(E(d))?(y(),r(p,{key:1,align:`center`,label:E(B)(`design.isUnique`),width:80},{default:D(({row:e})=>[s(v,{disabled:``,"model-value":e.isUnique||k.value.includes(e.name)},null,8,[`model-value`])]),_:1},8,[`label`])):i(``,!0),[`DuckDB`].includes(E(d))?i(``,!0):(y(),r(p,{key:2,align:`center`,label:E(B)(`design.isAutoIncrement`),width:`130`},{default:D(({row:e,$index:t})=>[s(v,{modelValue:e.isAutoIncrement,"onUpdate:modelValue":t=>e.isAutoIncrement=t,disabled:!e.isPrimary||!de.value,onChange:n=>_e(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`,`onChange`])]),_:1},8,[`label`])),[`SQLite`].includes(E(d))?i(``,!0):(y(),r(p,{key:3,label:E(B)(`design.operation`),width:`100`},{default:D(({row:e})=>[n(`div`,ze,[s(l,{type:`icon`,icon:`codicon-edit`,title:`edit`,onClick:t=>X(e)},null,8,[`onClick`]),s(l,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>ye(e)},null,8,[`onClick`])])]),_:1},8,[`label`])),W.value?(y(),a(e,{key:4},[s(p,{align:`center`,label:`UNSIGNED`,width:`100`},{default:D(({row:e,$index:t})=>[s(v,{modelValue:e.unsigned,"onUpdate:modelValue":t=>e.unsigned=t,"true-value":`1`,"false-value":`0`,onChange:n=>_e(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`onChange`])]),_:1}),s(p,{align:`center`,label:`Zerofill`,width:`80`},{default:D(({row:e,$index:t})=>[s(v,{modelValue:e.zerofill,"onUpdate:modelValue":t=>e.zerofill=t,"true-value":`1`,"false-value":`0`,onChange:n=>_e(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`onChange`])]),_:1})],64)):i(``,!0)]),_:1},8,[`data`,`height`])),[[U,j.value]]):i(``,!0),s(H,{modelValue:L.editVisible,"onUpdate:modelValue":c[12]||=e=>L.editVisible=e,"show-close":!1,title:ie.value,width:`680px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:D(()=>[s(l,{type:`secondary`,onClick:c[11]||=e=>L.editVisible=!1},{default:D(()=>[o(w(E(B)(`common.cancel`)),1)]),_:1}),s(l,{type:`primary`,loading:L.editLoading,disabled:L.editDisable,onClick:Z},{default:D(()=>[o(w(E(B)(`common.ok`)),1)]),_:1},8,[`loading`,`disabled`]),c[14]||=n(`br`,null,null,-1),c[15]||=o(),c[16]||=n(`br`,null,null,-1),O(s(ge,{ref:`cmEditor`,value:K.value,readonly:!0},null,8,[`value`]),[[F,K.value]])]),default:D(()=>[s(z,{inline:!0,"label-width":`90px`,size:`small`},{default:D(()=>[s(M,null,{label:D(()=>[s(x),o(w(E(B)(`common.name`)),1)]),default:D(()=>[s(T,{modelValue:P.name,"onUpdate:modelValue":c[0]||=e=>P.name=e,size:`small`,fixed:``},null,8,[`modelValue`])]),_:1}),R.value?(y(),r(M,{key:0,label:`ZEROFILL`},{default:D(()=>[s(v,{modelValue:P.zerofill,"onUpdate:modelValue":c[1]||=e=>P.zerofill=e,"true-value":`1`,"false-value":`0`},null,8,[`modelValue`])]),_:1})):i(``,!0),ne.value?(y(),r(M,{key:1,label:`CURRENT_TIMESTAMP`,"label-width":`160px`},{default:D(()=>[s(v,{modelValue:P.useCurrentTimestamp,"onUpdate:modelValue":c[2]||=e=>P.useCurrentTimestamp=e,onChange:J},null,8,[`modelValue`])]),_:1})):i(``,!0),c[13]||=n(`br`,null,null,-1),s(M,null,{label:D(()=>[s(x),o(w(E(B)(`common.type`)),1)]),default:D(()=>[s(N,{visible:_.visible,"onUpdate:visible":c[6]||=e=>_.visible=e,placement:`bottom-start`,"popper-class":`!p-0`,trigger:`click`,tabindex:null},{reference:D(()=>[s(T,{modelValue:P.type,"onUpdate:modelValue":c[3]||=e=>P.type=e,size:`small`,fixed:``,onKeyup:I(Y,[`enter`]),onInput:c[4]||=e=>{_.inputting=!0,_.visible=!0},onClick:c[5]||=e=>_.inputting=!1},null,8,[`modelValue`])]),default:D(()=>[n(`div`,Be,[(y(!0),a(e,null,S(ae.value,(t,n)=>(y(),a(e,null,[t==`hr`?(y(),a(`div`,{key:n,class:`w-full type-hr bg-bg`})):(y(),a(`div`,{key:1,class:`el-select-dropdown__item !h-6 min-w-[190px] bg-[var(--vscode-dropdown-background)]`,onClick:e=>{P.type=t.value||t,_.visible=!1}},w(t.label||t),9,Ve))],64))),256))])]),_:1},8,[`visible`])]),_:1}),q(`ClickHouse`)?(y(),r(M,{key:2,label:E(B)(`design.isNotNull`)},{default:D(()=>[s(v,{modelValue:P.isNotNull,"onUpdate:modelValue":c[7]||=e=>P.isNotNull=e},null,8,[`modelValue`])]),_:1},8,[`label`])):i(``,!0),R.value?(y(),r(M,{key:3,label:`UNSIGNED`},{default:D(()=>[s(v,{modelValue:P.unsigned,"onUpdate:modelValue":c[8]||=e=>P.unsigned=e,"true-value":`1`,"false-value":`0`},null,8,[`modelValue`])]),_:1})):i(``,!0),![`Snowflake`].includes(E(d))||L.isNew?(y(),r(M,{key:4,label:E(B)(`common.default`)},{default:D(()=>[s(T,{modelValue:P.defaultValue,"onUpdate:modelValue":c[9]||=e=>P.defaultValue=e,size:`small`,fixed:``},null,8,[`modelValue`])]),_:1},8,[`label`])):i(``,!0),[`DuckDB`].includes(E(d))?i(``,!0):(y(),r(M,{key:5,label:E(B)(`common.comment`)},{default:D(()=>[s(T,{modelValue:P.comment,"onUpdate:modelValue":c[10]||=e=>P.comment=e,size:`small`,fixed:``},null,8,[`modelValue`])]),_:1},8,[`label`]))]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),Ue=W(He,[[`__scopeId`,`data-v-ab428a54`]]);const We={class:`ml-4`},Ge={class:`flex flex-col gap-y-2`},Ke={class:`flex-wrap`},qe={class:`inline-block mr-5`},Je={class:`font-bold mr-5 inline-block`},Ye={class:`inline-block mr-5`},Xe={class:`font-bold mr-5 inline-block`},Ze={class:`flex-wrap`},Qe={key:0,class:`inline-block mr-5`},$e={class:`font-bold mr-5 inline-block`},et={key:1,class:`inline-block mr-5`},tt={class:`font-bold mr-5 inline-block`},nt={class:`inline-block pt-1`};var rt=c({__name:`InfoPanel`,setup(t){let c=Q(),{dialect:l}=z(c),d=x([]),f=b({name:null,schema:null,newTableName:null,comment:null,newComment:null,collation:null,newCollation:null});v(()=>{u.on(`designMetaNext`,e=>{f.name=e.table,f.schema=e.schema,f.newTableName=e.table,f.comment=e.comment,f.newComment=e.comment,f.collation=e.collation,f.newCollation=e.collation}).on(`collations`,e=>{d.value=e})});let p=()=>{let e={...f,table:f.name};u.emit(`updateTable`,e);let t=l.value.updateTable(e);t?u.emit(`execute`,{type:`table`,sql:t}):U(`No any change!`)};return(t,l)=>{let u=V,m=ie,h=ae,g=C(`vsc-button`);return y(),a(`div`,We,[n(`div`,Ge,[n(`div`,Ke,[n(`div`,qe,[n(`label`,Je,w(t.$t(`design.table`)),1),s(u,{modelValue:f.newTableName,"onUpdate:modelValue":l[0]||=e=>f.newTableName=e,class:`!w-48`,required:``,onKeyup:I(p,[`enter`])},null,8,[`modelValue`])]),n(`div`,Ye,[n(`label`,Xe,w(t.$t(`common.comment`)),1),s(u,{modelValue:f.newComment,"onUpdate:modelValue":l[1]||=e=>f.newComment=e,class:`!w-48`,onKeyup:I(p,[`enter`])},null,8,[`modelValue`])])]),n(`div`,Ze,[E(c).tableMeta.engine?(y(),a(`div`,Qe,[n(`label`,$e,w(t.$t(`design.engine`)),1),s(u,{value:E(c).tableMeta.engine,class:`!w-24`,disabled:``},null,8,[`value`])])):i(``,!0),f.collation&&d.value.length>0?(y(),a(`div`,et,[n(`label`,tt,w(t.$t(`design.collate`)),1),s(h,{modelValue:f.newCollation,"onUpdate:modelValue":l[2]||=e=>f.newCollation=e,size:`small`,filterable:``,class:`w-44`},{default:D(()=>[(y(!0),a(e,null,S(d.value,e=>(y(),r(m,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])])):i(``,!0),n(`div`,nt,[s(g,{type:`success`,onClick:p},{default:D(()=>[o(w(t.$t(`common.update`)),1)]),_:1})])])])])}}}),it=rt;const at={key:0,class:`design-toolbar`},ot={class:`text-center`};var st=c({__name:`Check`,setup(e){let c=Q(),{dialect:l,canAlterTable:d,remainHeight:f,activePanel:p}=z(c),m=x([]),h=x(!0),g=b({visible:!1,loading:!1}),_=b({clause:null}),S=t(()=>_.clause?l.value.newCheck(_.clause):``);v(()=>{u.on(`designMetaNext`,e=>{e.isSupportCheck&&(T(),g.visible=!1)}).on(`checks`,e=>{h.value=!1,m.value=e}).on(`success`,e=>{e==`check`&&(T(),g.visible=!1,g.loading=!1)}).on(`error`,()=>{g.loading=!1})});let T=()=>{let e=l.value.showChecks();if(!e){console.log(`This database type does not currently support check.`),h.value=!1;return}h.value=!0,u.emit(`checks`,e)},k=()=>{g.visible=!0,g.loading=!1,_.clause=null},A=()=>{g.loading=!0,u.emit(`execute`,{type:`check`,sql:S.value})},j=e=>{H(B(`design.deleteCheckConfirm`)).then(()=>{u.emit(`execute`,{type:`check`,sql:l.value.dropCheck(e.name)})})};return(e,t)=>{let c=C(`vsc-button`),l=C(`vsc-tooltip`),u=se,v=oe,b=C(`RedMark`),x=V,M=te,N=ee,P=ce,R=Te;return y(),a(`div`,null,[E(d)?(y(),a(`div`,at,[s(l,{title:E(B)(`common.new`)},{default:D(()=>[s(c,{type:`icon`,icon:`codicon-add text-base`,onClick:k})]),_:1},8,[`title`]),s(l,{title:E(B)(`common.refresh`)},{default:D(()=>[s(c,{type:`icon`,icon:`codicon-refresh text-base`,onClick:T})]),_:1},8,[`title`])])):i(``,!0),E(p)==`check`?O((y(),r(v,{key:1,data:m.value,height:E(f),border:``},{default:D(()=>[E(d)?(y(),r(u,{key:0,resizable:!0,align:`center`,prop:`name`,label:E(B)(`design.constraintName`),width:`200`},null,8,[`label`])):i(``,!0),s(u,{resizable:!0,align:`center`,prop:`clause`,label:E(B)(`design.clause`),width:`200`},null,8,[`label`]),E(d)?(y(),r(u,{key:1,label:E(B)(`design.operation`),width:`100`},{default:D(({row:e})=>[n(`div`,ot,[s(c,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>j(e)},null,8,[`onClick`])])]),_:1},8,[`label`])):i(``,!0)]),_:1},8,[`data`,`height`])),[[R,h.value]]):i(``,!0),s(P,{modelValue:g.visible,"onUpdate:modelValue":t[3]||=e=>g.visible=e,"show-close":!1,title:E(B)(`design.newCheck`),width:`430px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:D(()=>[s(c,{type:`secondary`,onClick:t[2]||=e=>g.visible=!1},{default:D(()=>[o(w(E(B)(`common.cancel`)),1)]),_:1}),s(c,{type:`primary`,loading:g.loading,onClick:A},{default:D(()=>[o(w(E(B)(`common.ok`)),1)]),_:1},8,[`loading`]),t[4]||=n(`br`,null,null,-1),t[5]||=o(),t[6]||=n(`br`,null,null,-1),O(s(ge,{ref:`cmEditor`,value:S.value,readonly:!0},null,8,[`value`]),[[F,S.value]])]),default:D(()=>[s(N,{inline:!0,"label-width":`80px`,"label-position":`left`,onSubmit:t[1]||=L(()=>{},[`prevent`]),onKeyup:I(A,[`enter`])},{default:D(()=>[s(M,null,{label:D(()=>[s(b),o(w(E(B)(`design.clause`)),1)]),default:D(()=>[s(x,{modelValue:_.clause,"onUpdate:modelValue":t[0]||=e=>_.clause=e,class:`!w-[290px]`,size:`small`,placeholder:`e.g. id >20 and name!='admin'`},null,8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),ct=st;const lt={key:0,class:`design-toolbar`};var ut=c({__name:`Trigger`,setup(e){let c=Q(),{dialect:l,canAlterTable:d,remainHeight:f,activePanel:p}=z(c),m=x([]),h=x(!0),g=b({visible:!1,loading:!1}),_=b({clause:null}),S=t(()=>``);v(()=>{u.on(`designMetaNext`,()=>{T(),g.visible=!1}).on(`triggers`,e=>{h.value=!1,m.value=e}).on(`success`,e=>{e==`trigger`&&(T(),g.visible=!1,g.loading=!1)}).on(`error`,()=>{g.loading=!1})});let T=()=>{h.value=!0,u.emit(`triggers`)},k=()=>{g.visible=!0,g.loading=!1,_.clause=null},A=()=>{g.loading=!0,u.emit(`execute`,{type:`trigger`,sql:S.value})},j=e=>{H(B(`design.deleteTriggerConfirm`)).then(()=>{u.emit(`execute`,{type:`trigger`,sql:l.value.dropTrigger(e.name)})})};return(e,t)=>{let c=C(`vsc-button`),l=C(`vsc-tooltip`),u=se,v=oe,b=C(`RedMark`),x=V,k=te,j=ee,M=ce,N=Te;return y(),a(`div`,null,[E(d)?(y(),a(`div`,lt,[s(l,{title:E(B)(`common.refresh`)},{default:D(()=>[s(c,{type:`icon`,icon:`codicon-refresh text-base`,onClick:T})]),_:1},8,[`title`])])):i(``,!0),E(p)==`trigger`?O((y(),r(v,{key:1,data:m.value,height:E(f),border:``},{default:D(()=>[s(u,{resizable:!0,align:`center`,prop:`trigger_name`,label:E(B)(`design.triggerName`),width:`200`},null,8,[`label`]),s(u,{resizable:!0,align:`center`,prop:`timing`,label:E(B)(`design.timing`),width:`200`},null,8,[`label`]),s(u,{resizable:!0,align:`center`,prop:`manipulation`,label:E(B)(`design.manipulation`),width:`200`},null,8,[`label`]),s(u,{resizable:!0,align:`center`,prop:`orientation`,label:E(B)(`design.orientation`),width:`200`},null,8,[`label`]),s(u,{resizable:!0,align:`center`,prop:`statement`,label:E(B)(`design.statement`),width:`200`},{default:D(e=>[o(w(e.row.source||e.row.statement),1)]),_:1},8,[`label`])]),_:1},8,[`data`,`height`])),[[N,h.value]]):i(``,!0),s(M,{modelValue:g.visible,"onUpdate:modelValue":t[3]||=e=>g.visible=e,"show-close":!1,title:E(B)(`design.newTrigger`),width:`430px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:D(()=>[s(c,{type:`secondary`,onClick:t[2]||=e=>g.visible=!1},{default:D(()=>[o(w(E(B)(`common.cancel`)),1)]),_:1}),s(c,{type:`primary`,loading:g.loading,onClick:A},{default:D(()=>[o(w(E(B)(`common.ok`)),1)]),_:1},8,[`loading`]),t[4]||=n(`br`,null,null,-1),t[5]||=o(),t[6]||=n(`br`,null,null,-1),O(s(ge,{ref:`cmEditor`,value:S.value,readonly:!0},null,8,[`value`]),[[F,S.value]])]),default:D(()=>[s(j,{inline:!0,"label-width":`80px`,"label-position":`left`,onSubmit:t[1]||=L(()=>{},[`prevent`]),onKeyup:I(A,[`enter`])},{default:D(()=>[s(k,null,{label:D(()=>[s(b),o(w(E(B)(`design.clause`)),1)]),default:D(()=>[s(x,{modelValue:_.clause,"onUpdate:modelValue":t[0]||=e=>_.clause=e,class:`!w-[290px]`,size:`small`,placeholder:`e.g. AFTER INSERT ON table_name FOR EACH ROW`},null,8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),dt=ut,$=class{constructor(e){this.meta=e,this.dialect=he(e.dbType),this.wrappedTable=Y(this.meta.table,this.meta.dbType,de.Always)}updateTable(e){return this.dialect.updateTable(e)}columnTypes(){return[`INTEGER`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATE`,`TIMESTAMP`,`hr`,`BOOLEAN`,`FLOAT`,`DOUBLE`,`hr`,`TEXT`,`JSON`,`BLOB`]}strategies(){return[`RESTRICT`,`CASCADE`,`SET NULL`,`SET DEFAULT`,`NO ACTION`]}newColumn(e){let{name:t,type:n,isNotNull:r}=e,i=r?` NOT NULL`:``;return`ALTER TABLE ${this.wrappedTable} ADD COLUMN ${Y(t,this.meta.dbType)} ${n}${i}`}updateColumn(e){return this.dialect.updateColumnSql({...e,table:this.meta.table,tableMeta:this.meta,schema:this.meta.schema})}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP COLUMN ${Y(e,this.meta.dbType)}`}formatIndexType(e){return e.index_type}indexTypes(){return[{label:`INDEX`,value:`INDEX`},{label:`UNIQUE`,value:`UNIQUE`}]}newIndex(e){return`ALTER TABLE ${this.wrappedTable} ADD INDEX (${e.columns.join(`,`)})`}dropIndex(e){return this.dialect.dropIndex(this.wrappedTable,e)}dropTrigger(e){return this.dialect.dropTriggerTemplate(e,this.wrappedTable)}showChecks(){return this.dialect.showChecks(this.meta.schema,this.meta.table)}showTriggers(){return this.dialect.showTriggers(this.meta.schema,this.meta.table)}showIndex(){return this.dialect.showIndex(this.meta.schema,this.meta.table)}showForeignKeys(){return this.dialect.showForeignKeys(this.meta.schema,this.meta.table)}newForeignKey(e){let{column:t,foreignKeyName:n,refTable:r,refColumn:i,onUpdate:a,onDelete:o}=e,s=a==`NO ACTION`?``:` ON UPDATE ${a}`,c=o==`NO ACTION`?``:` ON DELETE ${o}`;return new X(`ALTER TABLE "${this.meta.table}"`).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,`ADD`).append(`FOREIGN KEY ("${t}") REFERENCES "${r}"("${i}")${s}${c};`).toString()}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT ${e};`}newCheck(e){return`ALTER TABLE ${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE ${this.wrappedTable} DROP CONSTRAINT ${e};`}splitColumn(e,t=`"`){return e.map(e=>t+e+t).join(`,`)}},ft=class extends ${columnTypes(){return[`Int32`,`String`,`Float32`,`hr`,`Date`,`DateTime`,`hr`,`BOOLEAN`,`UUID`,{label:`Array`,value:`Array(String)`},`hr`,`JSON`,{label:`Tuple`,value:`Tuple(String)`},{label:`Map`,value:`Map(String,String)`},`hr`,`Int8`,`Int16`,`Int64`,`Int128`,`Int256`,`UInt8`,`UInt16`,`UInt32`,`UInt64`,`UInt128`,`UInt256`,`hr`,`DateTime64`,`DateTime32`,`hr`,`Decimal32`,`Decimal64`,`Decimal128`,`Decimal256`,`hr`,`IPv4`,`IPv6`,`hr`,{label:`Enum8`,value:`Enum8('a'=1)`},{label:`Enum16`,value:`Enum16('a'=1)`},`hr`,{label:`FixedString`,value:`FixedString(100)`}]}newColumn(e){let{name:t,type:n,defaultValue:r,comment:i}=e;return new X(`ALTER TABLE ${this.wrappedTable} ADD COLUMN "${t}" ${n}`).if(!J(r),`DEFAULT ${q(r,n)}`).if(i,`COMMENT '${i}'`).toString()}newIndex(e){let{columns:t}=e;return`ALTER TABLE "${this.meta.table}" ADD INDEX ${t.join(``)}_${new Date().getTime()}_index expression TYPE type GRANULARITY value AFTER ${this.splitColumn(t)}`}showForeignKeys(){return null}showChecks(){return null}},pt=class extends ${newColumn(e){let{name:t,type:n,defaultValue:r,isNotNull:i}=e;return new X(`ALTER TABLE "${this.meta.schema}".${Y(this.meta.table,this.meta.dbType)} ADD ${Y(t,this.meta.dbType)} ${n}`).if(i,`NOT NULL`).if(!J(r),`DEFAULT ${q(r,n)}`).toString()}dropColumn(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP COLUMN ${Y(e,this.meta.dbType)}`}newIndex(e){let{table:t=this.meta.table,columns:n,type:r}=e,i=`${t}_${n.join(`_`)}_${new Date().getTime()}`,a=r==`UNIQUE`?`UNIQUE`:``;return`CREATE ${a} INDEX ${i} ON "${this.meta.schema}"."${t}"(${this.splitColumn(n)});`}newCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP CONSTRAINT ${e};`}dropForeignKey(e){return`ALTER TABLE "${this.meta.schema}"."${this.meta.table}" DROP CONSTRAINT ${e};`}newForeignKey(e){return super.newForeignKey(e).replace(`"${this.meta.table}"`,`"${this.meta.schema}"."${this.meta.table}"`)}},mt=class extends ${indexTypes(){return[{label:`INDEX`,value:`INDEX`},{label:`UNIQUE`,value:`UNIQUE`},{label:`FULLTEXT`,value:`FULLTEXT`}]}columnTypes(){return[`INT`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATETIME`,`TIMESTAMP`,`DATE`,`hr`,`BIT`,`FLOAT`,`DOUBLE`,{label:`DECIMAL`,value:`DECIMAL(10,2)`},`BIGINT`,`hr`,`TEXT`,`JSON`,`BLOB`,`BINARY`,`hr`,{label:`ENUM`,value:`ENUM('item')`},{label:`SET`,value:`SET('item')`},`hr`,`TINYINT`,`SMALLINT`,`MEDIUMINT`,`hr`,`TIME`,`YEAR`,`hr`,`VARBINARY`,`TINYBLOB`,`MEDIUMBLOB`,`LONGBLOB`,`TINYTEXT`,`MEDIUMTEXT`,`LONGTEXT`,`hr`,`GEOMETRY`,`POINT`,`LINESTRING`,`POLYGON`,`MULTIPOINT`,`MULTILINESTRING`,`MULTIPOLYGON`,`GEOMETRYCOLLECTION`]}newColumn(e){let{name:t,type:n,comment:r,defaultValue:i,isNotNull:a,unsigned:o,zerofill:s}=e;return console.log(e),new X(`ALTER TABLE ${this.wrappedTable} ADD COLUMN \`${t}\` ${n}`).if(o&&o!=0,`UNSIGNED`).if(s,`ZEROFILL`).if(a,`NOT NULL`).if(r,`COMMENT '${r}'`).if(!J(i),`DEFAULT ${q(i,n)}`).toString()}formatIndexType(e){let t=e.index_type.toUpperCase();return t==`BTREE`?e.index_name==`PRIMARY`?`PRIMARY`:fe(e.isUnique)?`UNIQUE`:`KEY`:t}newIndex(e){let{type:t=`key`,columns:n}=e;return`ALTER TABLE \`${this.meta.table}\` ADD ${t} (${this.splitColumn(n,"`")})`}newForeignKey(e){let{column:t,foreignKeyName:n,refTable:r,refColumn:i,onUpdate:a,onDelete:o}=e,s=a==`NO ACTION`?``:` ON UPDATE ${a}`,c=o==`NO ACTION`?``:` ON DELETE ${o}`;return new X(`ALTER TABLE \`${this.meta.table}\``).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,`ADD`).append(`FOREIGN KEY (\`${t}\`) REFERENCES \`${r}\`(\`${i}\`)${s}${c};`).toString()}dropForeignKey(e){return`ALTER TABLE \`${this.meta.table}\` DROP FOREIGN KEY ${e};`}},ht=class extends ${newIndex(e){let{table:t=this.meta.table,columns:n,type:r}=e,i=`${t}_${n.join(`_`)}_${new Date().getTime()}`,a=r==`UNIQUE`?`UNIQUE`:``;return`CREATE ${a} INDEX ${i} ON "${t}"(${this.splitColumn(n)})`}newColumn(e){let{name:t,type:n,isNotNull:r,defaultValue:i,comment:a}=e;return new X(`ALTER TABLE ${Y(this.meta.table,this.meta.dbType)} ADD ${t} ${n}`).if(!J(i),`DEFAULT ${q(i,n)}`).if(r,`NOT NULL`).if(a,`;\nCOMMENT ON COLUMN ${this.wrappedTable}."${t.toUpperCase()}" is '${a}';`).toString()}newForeignKey(e){let{column:t,foreignKeyName:n,refTable:r,refColumn:i,onUpdate:a,onDelete:o}=e,s=a==`NO ACTION`?``:` ON UPDATE ${a}`,c=o==`NO ACTION`?``:` ON DELETE ${o}`,l=n||`${t}_${r}_${i}_fk_${Math.floor(Math.random()*30)}`;return`ALTER TABLE "${this.meta.table}" ADD CONSTRAINT ${l} FOREIGN KEY ("${t}") REFERENCES ${r}(${i})${s}${c};`}showForeignKeys(){var e;let{schema:t}=this.meta;return t?.toLowerCase()==(e=this.meta.user)?.toLowerCase()&&(t=void 0),this.dialect.showForeignKeys(t,this.meta.table)}columnTypes(){return[`INTEGER`,{label:`VARCHAR2`,value:`VARCHAR2(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATE`,`TIMESTAMP`,`hr`,`NUMBER`,`FLOAT`,`hr`,`CLOB`,`BLOB`,`hr`,`BINARY_FLOAT`,`BINARY_DOUBLE`,`hr`,`TIMESTAMP WITH TIME ZONE`,`TIMESTAMP WITH LOCAL TIME ZONE`,`hr`,`INTERVAL YEAR TO MONTH`,`INTERVAL DAY TO SECOND`,`hr`,`RAW`,`LONG RAW`,`LONG`,`hr`,`NCHAR`,`NVARCHAR2`,`NCLOB`,`hr`,`BFILE`,`ROWID`,`UROWID`]}},gt=class extends ${newColumn(e){let{name:t,type:n,comment:r,defaultValue:i,isNotNull:a}=e,o=this.wrappedTable;return new X(`ALTER TABLE ${o} ADD COLUMN "${t}" ${n}`).if(a,`NOT NULL`).if(!J(i),`DEFAULT ${q(i,n)}`).append(`;`).if(r,`\nCOMMENT ON COLUMN ${o}."${t}" is '${r}';`).toString()}columnTypes(){return[`INTEGER`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`TIMESTAMP`,`DATE`,`BOOLEAN`,`FLOAT`,`TEXT`,`JSON`,`BLOB`,`hr`,`SMALLINT`,`BIGINT`,`REAL`,`DOUBLE PRECISION`,`hr`,`BYTEA`,`XML`,`UUID`,`ARRAY`,`hr`,`NUMERIC`,`MONEY`,`INTERVAL`,`CIDR`,`INET`,`MACADDR`]}indexTypes(){return[{label:`INDEX`,value:`INDEX`},{label:`UNIQUE`,value:`UNIQUE`},{label:`HASH`,value:`HASH`}]}newIndex(e){let{table:t=this.meta.table,columns:n,type:r}=e,i=r==`HASH`?`hash`:`btree`,a=r==`UNIQUE`?`UNIQUE`:``;return`CREATE ${a} INDEX ${n.join(`_`)}_${new Date().getTime()}_index ON "${t}" USING ${i} (${this.splitColumn(n)});`}},_t=class extends ${newIndex(e){throw Error(`Method not implemented.`)}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT "${e}";`}showForeignKeys(){return`select
       rco.constraint_name "constraint_name",
       rco.UPDATE_RULE "updateRule",
       rco.DELETE_RULE "deleteRule",
       pk_tco.table_name "referenced_table"
from information_schema.referential_constraints rco
    join information_schema.table_constraints fk_tco on fk_tco.constraint_name = rco.constraint_name and fk_tco.constraint_schema = rco.constraint_schema
    join information_schema.table_constraints pk_tco on pk_tco.constraint_name = rco.unique_constraint_name and pk_tco.constraint_schema = rco.unique_constraint_schema
    WHERE fk_tco.TABLE_SCHEMA='${this.meta.schema}' and fk_tco.table_name='${this.meta.table}' 
    ORDER BY rco.CREATED`}},vt=class extends ${newIndex(e){let{table:t=this.meta.table,columns:n}=e,r=`${t}_${n.join(`_`)}_${new Date().getTime()}`;return`CREATE INDEX ${r} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT "from" column_name, "table" referenced_table, "to" referenced_column,
        on_update, on_delete 
        FROM pragma_foreign_key_list('${this.meta.table}');`}showChecks(){return null}},yt=class extends ${newColumn(e){let{type:t,defaultValue:n}=e;return new X(super.newColumn(e)).if(!J(n),`DEFAULT ${q(n,t)}`).toString()}newIndex(e){let{table:t=this.meta.table,columns:n}=e,r=`${t}_${n.join(`_`)}_${new Date().getTime()}`;return`CREATE INDEX ${r} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT constraint_column_names "column_name" FROM duckdb_constraints()
        WHERE constraint_type='FOREIGN KEY' and database_name not in ('system','temp') and schema_name='${this.meta.schema}' and table_name='${this.meta.table}'`}showChecks(){return null}},bt=class extends pt{columnTypes(){return[`INTEGER`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATE`,`TIMESTAMP`,`TIME`,`hr`,`BOOLEAN`,`FLOAT`,`DOUBLE`,`hr`,`TEXT`,`BLOB`,`hr`,`SMALLINT`,`BIGINT`,`DECFLOAT`,`hr`,`TIMESTAMP WITH TIME ZONE`,`TIME WITH TIME ZONE`,`hr`,`XML`,`GRAPHIC`,`VARGRAPHIC`,`hr`,`DBCLOB`,`CLOB`]}},xt=class extends pt{columnTypes(){return`INTEGER.TEXT.hr.DATE.TIMESTAMP.hr.BOOLEAN.FLOAT.DOUBLE.hr.BLOB.hr.BIGINT.SMALLINT.TINYINT.VARINT.hr.TIME.TIMEUUID.hr.DECIMAL.COUNTER.hr.UUID.INET.ASCII.DURATION`.split(`.`)}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP ${Y(e,this.meta.dbType)}`}};function St(e){switch(e.dbType){case G.PG:case G.REDSHIFT:case G.KINGBASE:case G.GAUSS_DB:case G.COCKROACH:return new gt(e);case G.DM:case G.ORACLE:return new ht(e);case G.DB2:return new bt(e);case G.CASSANDRA:return new xt(e);case G.SQLServer:return new pt(e);case G.SNOWFLAKE:return new _t(e);case G.CLICKHOUSE:return new ft(e);case G.DUCK_DB:return new yt(e);case G.D1:case G.libSQL:case G.SQLITE:return new vt(e);case G.MYSQL:case G.MARIA_DB:case G.DATABRICKS:return new mt(e);default:return new $(e)}}const Ct={class:`mt-2 design-container`},wt={id:`infoPanel`},Tt={class:`tab`},Et=[`onClick`],Dt={class:`design-data-container`};var Ot=c({__name:`design`,setup(r){let c=x(!1),l=Q(),d=t(()=>l.activePanel),f=t(()=>[{id:`ddl`,i18n:`design.ddl`,icon:`codicon-edit green`},{id:`column`,i18n:`design.column`,icon:`codicon-symbol-field blue`},{id:`foreignKey`,i18n:`design.foreignKey`,icon:`codicon-symbol-class yellow`,hidden:t(()=>!l.supportForeignKey)},{id:`index`,i18n:`design.index`,icon:`codicon-github-action purple`,hidden:t(()=>!l.supportIndex)},{id:`trigger`,i18n:`design.trigger`,icon:`codicon-github-action orange`,hidden:t(()=>!l.supportTrigger)},{id:`check`,i18n:`design.check`,icon:`codicon-tools red`,hidden:t(()=>!l.supportCheck||!c.value)}].filter(e=>{var t;return(e==null||(t=e.hidden)==null?void 0:t.value)!=1}));v(()=>{u.on(`dbType`,e=>{l.updateDBType(e)}).on(`designMeta`,e=>{c.value=e.isSupportCheck,l.dialect=St(e),l.updateFullInfo(e),u.emitImmediately(`designMetaNext`,e)}).on(`success`,()=>{ne(B(`design.updateSuccess`))}).on(`error`,e=>{U(e)}).on(`refresh_design`,()=>{p()}),p(),pe(55,[`tableTab`,`infoPanel`],e=>{l.remainHeight=e})});let p=()=>{u.emit(`init`,{type:`design`})};return(t,r)=>(y(),a(`div`,Ct,[n(`div`,wt,[s(it),n(`ul`,Tt,[(y(!0),a(e,null,S(f.value,(e,t)=>(y(),a(`li`,{key:t,class:g([`tab__item`,{"tab__item--active":d.value==e.id}]),onClick:t=>E(l).activePanel=e.id},[e.icon?(y(),a(`i`,{key:0,type:`icon`,class:g(e.icon),style:{position:`relative`,top:`3px`}},null,2)):i(``,!0),o(` `+w(E(B)(e.i18n)),1)],10,Et))),128))])]),n(`div`,Dt,[O(s(Me,null,null,512),[[F,d.value==`ddl`]]),O(s(Ue,null,null,512),[[F,d.value==`column`]]),O(s(Ie,null,null,512),[[F,d.value==`foreignKey`]]),O(s(ke,null,null,512),[[F,d.value==`index`]]),O(s(dt,null,null,512),[[F,d.value==`trigger`]]),O(s(ct,null,null,512),[[F,d.value==`check`]])])]))}}),kt=W(Ot,[[`__scopeId`,`data-v-68f3d12d`]]);export{kt as default};