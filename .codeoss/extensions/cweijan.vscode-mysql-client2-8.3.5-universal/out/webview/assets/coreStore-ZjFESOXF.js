import{handler as e}from"./vscode-ByQLBi_r.js";import{defineStore as t}from"./pinia-BVG5H93L.js";import{error as n,success as r}from"./notify-DqF5XRqJ.js";import{defaultState as i}from"./defaultConfig-D4KV4pTk.js";const a=t(`core`,{state:()=>({state:{},uiState:{...i},config:{autoSync:!1,disableTLSVerification:!1},userInit:!1,user:null,account:{offlineVisible:!1,loginLoading:!1,accountVisible:!1}}),getters:{isPay(e){var t;return!e.userInit||(e==null||(t=e.user)==null?void 0:t.expireTime)>new Date().getTime()},isAdmin(e){var t;return(t=e.user)?.email==`weijancc@gmail.com`},nickInitials(e){var t,n;let r=(t=e.user)?.nickName||(n=e.user)?.email;return r.split(` `).slice(0,2).map(e=>e[0]).join(``)},isForever(e){if(!e.user)return!1;let t=e.user.expireTime;return new Date(t).getFullYear()-new Date().getFullYear()>10},expireText(e){var t;let n=(t=e.user)?.expireDate;if(!n)return`Free`;let r=e.user.expireTime;return new Date().getTime()>r?`${n} -> Expire`:this.isForever?`Lifetime Premium`:n}},actions:{upState(t,n=this.uiState[t]){e.emit(`upState`,{key:t,value:n})},upConfig(t){e.emit(`upConfig`,{key:t,value:this.config[t]})},openLogin(){navigator.userAgent.toLowerCase().includes(`electron`)?this.loginOnBrowser():this.openLoginDialog()},loginOnBrowser(){e.emit(`loginOnBrowser`)},thridAuth(t){e.emit(`thridAuth`,t)},openLoginDialog(){this.account.accountVisible=!0},loginDone(){r(`Login success!`),this.account.loginLoading=!1,this.account.accountVisible=!1,this.account.offlineVisible=!1,e.emit(`getUser`)}}});function o(t){let r=a();r.state=t,r.config=t.config||{},r.uiState=Object.assign(r.uiState,t.state||{}),e.on(`user`,e=>{r.user=e,r.userInit=!0}).on(`updateState`,(e={})=>{Object.assign(r.state,e)}).on(`loginRes`,({errMsg:e})=>{r.account.loginLoading=!1,e?n(e):r.loginDone()})}export{o as bindCoreHandler,a as useCoreStore};